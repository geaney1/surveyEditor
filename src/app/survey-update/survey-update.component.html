<h2>Add New Survey</h2>

<form class="update-survey" [formGroup]="updateSurveyForm" (ngSubmit)="onSubmit()">

<!--- Survey Title Input --->
<mat-form-field class="text-input">
  <mat-label>Title</mat-label>
  <input matInput type="text" formControlName="title"
           placeholder="Enter the title">
  @if (updateSurveyForm.get('title')?.value) {
    <button matSuffix matIconButton class="clear-button" aria-label="Clear" (click)="updateSurveyForm.patchValue({ title: '' })">
      <mat-icon>X</mat-icon>
    </button>
  }
  @if (updateSurveyForm.get('title')?.hasError('title') && !updateSurveyForm.get('title')?.hasError('required')) {
    <mat-error>Please enter a valid survey title</mat-error>
  }
  @if (updateSurveyForm.get('title')?.hasError('required')) {
    <mat-error>Title is <strong>required</strong></mat-error>
  }
  </mat-form-field>

<!--- Survey Description Input --->
  <mat-form-field class="text-input">
  <mat-label>Description</mat-label>
  <input matInput type="text" formControlName="description"
           placeholder="Enter the description">
  @if (updateSurveyForm.get('description')?.value) {
    <button matSuffix matIconButton class="clear-button" aria-label="Clear" (click)="updateSurveyForm.patchValue({ description: '' })">
      <mat-icon>X</mat-icon>
    </button>
  }
  @if (updateSurveyForm.get('description')?.hasError('description') && !updateSurveyForm.get('description')?.hasError('required')) {
    <mat-error>Please enter a valid description</mat-error>
  }
  @if (updateSurveyForm.get('description')?.hasError('required')) {
    <mat-error>Description is <strong>required</strong></mat-error>
  }
  </mat-form-field>

  
   @if(questions && questions.length > 0) { 
    @for(quest of questions; track quest.questionId) {
      <app-question-card [question]="quest"></app-question-card>
    }
  }
  <!-- Add Question Button -->
  <button type="button" (click)="addNewQuestion()">Add new question</button>
  
  <!-- New Question Form -->
  @if(showQuestionForm && isAddNewSurvey) {
    <app-question-update [question]="question" [isAddNewQuestion]="true" [questionCnt]="questions.length + 1" ></app-question-update>
  }
  
  
  

  <!-- Submit Button -->
  <button class="submit-button" type="submit" [disabled]="updateSurveyForm.invalid">
    Save Survey
  </button>
</form>

<!-- Success Message -->
@if (submissionSuccess) {
<div class="success">
  <p>Survey successfully updated!</p>
</div>
}

<!-- Error Message -->
@if (submissionError) {
<div class="error">
  <p>{{ submissionError }}</p>
</div>
}
